/* Project DK ~DefenseKeys~

Island Defense Hotkey Tool - Modify your hotkeys
________________________________________________

Gui, 2 :: Main gui
*/

version := 1.4
name = DefenseKeys by aRt)Y

;### Settings ####
settingspath = %A_workingdir%\DK Settings.ini
options = ---Commands---|CmdMove|CmdStop|CmdHoldPos|CmdAttack|CmdPatrol|CmdSelectSkill|CmdCancel|---Miscs---|Gather Gold|Gather|Repair|Teleport|Blink|---Builders---|Murloc|Gnoll|Dryad|Arachnid|Pirate|Troll|Ogre|Radioactive|Morphling|Tauren|Draenei|Pandaren|Huntress|Demonologist|Faerie Dragon|Goblin|Nature|Magnataur|Satyr|---Scret Shop---|Eye|Wards|Potion|Scroll|Trident|Scales|Shadowstone|TP|ManualP|ManualH|GreaterTurtleRecipe|BracersRecipe|HammerRecipe|WillRecipe|MightRecipe|RingRecipe|CloakRecipe|StoneRecipe|Teleporter|Sword|---Merchant of Recipes|DominatorRec|AnkhRec|ArmorFateRec|GauntletsRageRec|ShadowCatcherRec|LifeEssRec|---Merchant of Consumables---|Chimaera|ReplenishmentPotion|Wand|StaffOfTeleportation|---Merchant of Artifacts---|WindCatcher|Pearl|MoonCrystal|MagicCoral|AbysmalWater|TridentOfPower|GemOfHaste|Webbed|RegSpines
rows := 20

IniRead,CustomKeys,%settingspath%,Settings,CustomKeysPath
If (Customkeys = "" || CustomKeys = "ERROR")
	CustomKeys = ""

;#### Settings/Install
IfNotExist,DK Settings.ini
{
	IniWrite,%options%,%settingspath%,Settings,Options
	IniWrite,%version%,%settingspath%,Settings,Version
	IniWrite,%rows%,%settingspath%,Settings,Rows

	FileSelectFolder, CustomKeys, S,%A_ProgramFiles%, Please choose the Warcraft 3 folder.

	If (ErrorLevel = "1")
	{
		IniWrite,%A_space%,%settingspath%,Settings,CustomKeysPath
		MsgBox,16,Information,The customkeys path doesn't exit. Please edit it in the settings or download the file manually and save it in the Warcraft 3 folder as Customkeys.txt:`nhttp://pdrmf.googlecode.com/files/DefenseKeysFile.txt`n`nYou can also retry it, just restart the program.`n`nThe program will exit.
		ExitApp
		return
	}
	else
		IniWrite,%CustomKeys%,%settingspath%,Settings,CustomKeysPath

	IfExist,%customkeys%
	{
		MsgBox,36,Defensekeys,Exchange the current CustomKeys.txt with the modifed Island Defense file (the originial will be moved in the DK's folder)?`n`nThe new customkeys.txt will be downloaded automatically even if you press no.`nFile downloaded from: https://code.google.com/p/pdrmf/downloads/detail?name=DefenseKeysFile.TXT`nIt will be moved and named in the Warcraft 3 folder as Customkeys.txt
		IfMsgBox, Yes
		{
			FileMove,%CustomKeys%/CustomKeys.txt,%CustomKeys%/CustomKeys Originial.txt
			FileMove,%CustomKeys%/CustomKeys Originial.txt,%A_workingdir%
		}
		IfMsgBox, Cancel
		{
			IfExist,%customkeys%\Customkeys.txt
				FileDelete,%customkeys%\Customkeys.txt
		}

		UrlDownloadToFile,http://pdrmf.googlecode.com/files/DefenseKeysFile.TXT,%customkeys%\CustomKeys.txt
	}
} ; end install

IfNotExist,%customkeys%
{
	MsgBox,16,DefenseKeys,The Warcraft 3 path doesn't exit.`nPlease edit the path in the settings or delete the settings to run the start-up.`nThe program will exit.
	ExitApp
	return
}


IfNotExist,%customkeys%\Customkeys.txt
{
	MsgBox,36,DefenseKeys,The CustomKeys.txt doesn't exit.`n`nWould you like to download it?
	IfMsgBox, Yes
	{
		IfNotExist,%customkeys%
		{
			MsgBox,16,DefenseKeys,The Warcraft 3 path doesn't exit.`n`nThe download has been canceled and the program will exit.
			ExitApp
			return
		}
		UrlDownloadToFile,http://pdrmf.googlecode.com/files/DefenseKeysFile.TXT,%customkeys%\Customkeys.txt
	}
	IfMsgBox, No
	{
		MsgBox,64,DefenseKeys,Without the CustomKeys.txt the program can not be started.`n`nThe program will exit.
		ExitApp
		Return
	}
}

IniRead,Options,%settingspath%,Settings,Options
If (Options = "ERROR" || Options = "")
{
	MsgBox,16,DefenseKeys,There're no options.`n`nDelete the settings or add the manually in the settings:`nOptions=Builder1|Builder2| etc.`n`nThe program will exit.
	ExitApp
	return
}
IniRead,Rows,%settingspath%,Settings,Rows
If (Rows = "ERROR" || Rows = "")
	Rows := 10

RegRead,hotkeys,HKEY_CURRENT_USER,Software\Blizzard Entertainment\Warcraft III\Gameplay, customkeys

;#### Start-up
Gui, 2: font, s11
Gui, 2: add, text, x5 y5,Please choose an option to modify:
Gui, 2: add, DDL, x5 y25 h25 w200 r%rows% gGather vBuilder,%options%
Gui, 2: add, checkbox, y28 x210 checked%hotkeys% gToggle vHotkeys, Hotkeys on
Gui, 2: add, edit, x5 y55 h300 w300 +vscroll vEdit,
Gui, 2: add, text, x315 y55 w280 +wrap,
Gui, 2: add, button, x95 y360 w80 h25 gInfo,Information
Gui, 2: add, button, x5 y360 w80 h25 gOverWrite,Save
Gui, 2: add, button, x185 y360 w120 h25 gMenu,Open...
Gui, 2: show, h390 w310,%name% - v%version%
GoSub, tray
return

toggle:
	Gui, 2: submit, nohide
	RegWrite,REG_DWORD,HKEY_CURRENT_USER,Software\Blizzard Entertainment\Warcraft III\Gameplay,customkeys,%hotkeys%
return

Menu:
{
	Menu,MyMenu,Add,CustomKeys,Open
	Menu,MyMenu,Add,Online readme,Readme
	Menu,myMenu,Add,Online changelog,changelog
	Menu,MyMenu,Show
	Menu,MyMenu, DeleteAll
}
return

open:
IfExist,%customkeys%\Customkeys.txt
	Run %CustomKeys%\Customkeys.txt
else
	TrayTip,Failed to open the file.,The path doesn't exit.,3,2
return

readme:
	Run, https://code.google.com/p/pdrmf/wiki/DKreadme
return	

changelog:
	Run, https://code.google.com/p/pdrmf/wiki/DKchangelog
return

Gather:
{
	FileRead,Keys,%CustomKeys%\Customkeys.txt
	found := 2  ; to check for [builder]
	toggle := 1 ; to check for part2
	edit =      ; the edit field
	spells =    ; the selected part
	counter := 0 ; To remove the [end] of the selected part

	KeyWait,Up
	KeyWait,Down
	KeyWait,Left
	KeyWait,Right

		part1 =
		spells =
		part2 = 
			Gui, 2: Submit, nohide
			
			If builder contains ---
				Return
				
			Loop, parse, keys,`n,`n
			{
				If (found = "1")
				{
					IfInString,A_loopField,[end]
					{
						found := 0
						toggle := 0
					}

					If (found = "1")
						spells .= A_loopField "`n"
				}

				IfInString,A_loopField,% "[" builder "]"
					found := 1

				If (found = "2" && toggle = "1")
					part1 .= A_loopField "`n"

				If (toggle = "0")
				{
					counter++
					If (counter > "1")
						part2 .= A_loopField "`n"
				}
			}
	If (found = 2)
		TrayTip,%builder% not found.,Please check the customkeys.txt if it exists.,3,2
}
GuiControl, 2:,Edit1,%spells%
return

OverWrite:
{
	SetTitleMatchMode, 2
	IfWinNotExist,CustomKeys.txt
	{
		text = 
		text1 = 
		Gui, 2: Submit, nohide
		FileDelete, %CustomKeys%\Customkeys.txt

		edit1 := "[" builder "]`n" edit "[end]`n"
		text := part1 edit1 part2
		Loop, parse, text,`n,`n
		{
			If (A_loopField != "")
				text1 .= A_loopField "`n"
		}

		FileAppend,%text1%,%CustomKeys%\Customkeys.txt
		TrayTip,Overwrite successful.,%A_space%,3,1
	}
	else
		TrayTip,Overwrite failed.,Please close the CustomKeys.txt!,3,2
}
return

tray:
{
Menu, Tray, DeleteAll
Menu Tray, NoStandard
Menu, Tray, add, Info & Support, Info99
Menu, Tray, add
Menu, Tray, add, Exit, 2GuiClose
Menu, Tray, Tip, DefenseKeys
GoSub, Icons
	IfExist,%A_workingdir%\logo.ico
		Menu, Tray, icon, %A_workingdir%\logo.ico
}
return

info99:
	MsgBox,64,Information & Support,DefenseKeys made by aRt)Y <ProjectDRMF@gmail.com>`n`nInformation concerning the DK-Project: https://code.google.com/p/pdrmf/
return

info:
{
MsgBox,64,Info,
( 
You can edit:
- Tip`n- Ubertip`n- Hotkey
- Unhotkey
- Researchhotkey`n`nIf you don't know what you are doing then don't edit the CustomKeys.txt manually.
`nThe CustomKeys.txt for Island Defense contains a specific syntax for the DK tool to retrieve the informations.
`nYou can not have both ID and DotA at the same time.
`nEach time you modify the CustomKeys.txt, you've to restart WC3 to make them working.
Do not forget to enable own customkeys in wc3.
`nDefenseKeys does not check for multiple same hotkeys.
)
}
return

2GuiClose:
ExitApp

loadHex()
{
	global
	picture = 
(join
0000010001002020000001002000A810000016000000280000002000000040000000010020000000000000000000000000000000000000000000000000002D3136BF4C464EFF544B54FF524E52FF515153FF4E4E4EFF4C4C4CFF4F504FFF515252FF515151FF4E4E4EFF4C4C4CFF4E4E4DFF505150FF4F5152FF4E4F50FF4E4E4FFF4D4E4EFF4B4B4BFF4A4A4BFF48494AFF484849FF484948FF494948FF494948FF474747FF454546FF454545FF454444FF464545FF3D3D3DFF26292BFF545A5EBF656266FF333439FF232526FF26292AFF25292AFF252929FF282B2CFF282B2DFF272A2BFF26292AFF25292AFF262A2AFF282C2CFF272B2DFF272B2BFF272B2BFF252A2AFF24282AFF242729FF242829FF242929FF242828FF242828FF242829FF232728FF222527FF222526FF232628FF232526FF2F3634FF40403FFF4E5656BF6C746FFF151E19FF050704FF060607FF060506FF070608FF070708FF080807FF080808FF090909FF0A0A09FF0A0A0BFF0B0A0AFF08080BFF070A0EFF080B0FFF0A090AFF0B0A09FF0A0A0AFF0B0A09FF0A0A09FF090908FF080808FF070707FF050506FF040404FF040404FF040303FF040404FF222627FF474646FF4D5655BF7B7F7BFF080E0BFF060805FF0C0A0BFF0C0C0DFF0D0D0FFF100F0FFF121112FF121212FF131313FF131314FF141513FF121414FF080D17FF051021FF061125FF10141AFF161713FF161815FF181714FF161515FF151413FF131313FF111211FF0E0F10FF0B0B0BFF080808FF060707FF040506FF222527FF464747FF494E50BF7C7C7BFF080A0CFF0A0908FF0F0E0DFF101111FF111211FF141314FF161517FF171615FF181916FF191A18FF191A1AFF181819FF0A0F1CFF071731FF091431FF161B23FF1C1D1DFF1C1D1FFF1E1D1CFF1C1B1CFF1A1B1BFF181A19FF171717FF151514FF111110FF0E0E0FFF090909FF030404FF232729FF474847FF4A5052BF7F8182FF080A0CFF070909FF070B14FF060B17FF060D17FF070E1AFF080F1BFF090F1CFF0A101DFF0A101DFF09111DFF0B111DFF071023FF0C2045FF0A1A38FF0A0F19FF0A0D17FF09111EFF0B101BFF0A0E1AFF090E1AFF090E1AFF070D18FF080D16FF070A14FF060A14FF080A0CFF040304FF222628FF464646FF4D5456BF828383FF080A0CFF090E11FF091B37FF0A2040FF092141FF0B2247FF0C2346FF0C2446FF0C2547FF0C264BFF0D284EFF0D274AFF091B38FF0C244CFF081936FF060D1CFF091A35FF0C2648FF0B2143FF0A1E3DFF091F3CFF091E3CFF091D3CFF0A1A37FF091936FF08172EFF0E1117FF060505FF222829FF474847FF4A5154BF828283FF070C0BFF0A0E15FF0C2449FF0D213DFF1A2739FF0B2447FF123562FF133664FF123463FF113462FF123364FF11335FFF0B203DFF0D2757FF0A1B3DFF050E1FFF0C2446FF11325DFF11325BFF12335CFF11335DFF0F3056FF0A203CFF142134FF0A1E37FF0C223EFF11151BFF0A0708FF23292AFF4A494AFF4E5559BF89898CFF090C0EFF0C131CFF12335AFF1E334BFF363D43FF11243FFF163B68FF174071FF174173FF164072FF174173FF173E6FFF0E2549FF0F2E68FF0D2550FF061124FF0E2B50FF153E6EFF153D6AFF143C6AFF133A67FF12325CFF142136FF31363CFF152A41FF0F2C4CFF151D20FF0C0A0BFF252A2AFF4E4B4DFF52595CBF8D908EFF0A0C0DFF0D151EFF123866FF143B64FF1A3A60FF153E6DFF1B4A7CFF194A7FFF19487EFF19467CFF19477DFF164375FF0F305FFF123B86FF0E2D62FF071428FF102F56FF184577FF174273FF174274FF164274FF16406FFF113358FF163254FF123054FF112E52FF151C24FF0C0C0CFF262D2DFF504F50FF545A5EBF929393FF0B0E0EFF0D131EFF0F2B57FF0F2F5FFF0F3162FF0F356BFF113870FF133A71FF12376EFF103469FF113467FF102F5EFF0F2F63FF15428FFF0F2B59FF050F1FFF0A2147FF0E3164FF0E3164FF113566FF123567FF0F3261FF0F2F5FFF0D2854FF0E2750FF0C2549FF1A2027FF0E0E0EFF282D2EFF515151FF585E5EBF9A999CFF0D1011FF0C0D13FF091B36FF071839FF071A3AFF07193BFF051737FF071838FF081839FF081939FF081838FF091938FF0F2C5CFF1A51A6FF13336FFF050B19FF051029FF081739FF061937FF061632FF061533FF061630FF091632FF05152CFF061332FF081325FF1B1C21FF100F0FFF282B2CFF515252FF586061BF9C9C9DFF0E1010FF0E121DFF0C2954FF0E2D55FF0A2141FF0D2A53FF103160FF102F5EFF113162FF123569FF13376DFF113869FF153E78FF2268C3FF184486FF051223FF092146FF103265FF0F3160FF0F2D5CFF102D59FF0F2C59FF0C2249FF0A223DFF0D254EFF0D2544FF20262BFF131212FF292C2CFF535556FF586062BF9B9D9EFF0D0F12FF101924FF173F73FF14345CFF222934FF182D46FF1A4880FF1B4A84FF1A4882FF194881FF1A4881FF19477EFF143D7BFF226ABDFF1B4F8CFF051023FF0E284EFF18447AFF18427AFF184277FF184175FF153E70FF192638FF1B222EFF102D51FF14315BFF222830FF141414FF2A2D2DFF545555FF585E61BF9C9C9CFF0D1111FF111A26FF1A487EFF163C69FF24374DFF1C3250FF1E4D85FF21528EFF21548FFF215590FF20548DFF1E4F8AFF194786FF2878BCFF205C93FF081429FF0F2A4EFF1D4F84FF1F4F85FF1E4D81FF1D4980FF184374FF1C2D42FF1F2E42FF113159FF183961FF252B33FF151516FF292D2EFF545456FF565D62BF9C9D9AFF0D1111FF111A23FF163F74FF1B4783FF19457EFF163C77FF1C4882FF1C4881FF1A4680FF1B4480FF1A437FFF194079FF153B71FF1D589CFF173F72FF061126FF0A1D3EFF173D6FFF1A3F78FF194177FF183F74FF173E71FF123566FF153A6AFF143969FF16325BFF262C34FF151817FF282D2EFF575756FF565E61BF9D9E9DFF0F1114FF0D1117FF091F45FF0A2249FF0C234CFF0C234FFF0D264EFF0D244EFF0B2147FF0B2146FF0C2149FF091C40FF0D1624FF242C3FFF222733FF0C0E16FF050F22FF091C3DFF081D40FF0A2043FF092046FF091F43FF0A1E45FF081D3FFF071D3BFF091933FF25292AFF171818FF2B2E31FF5B5C5BFF5A6162BFA2A2A5FF121315FF0E1017FF091A3CFF081B3DFF061631FF081835FF091C3DFF081937FF040E26FF050B1EFF060A1BFF060A19FF111112FF2D2B2AFF2C2A28FF121317FF040B1BFF050B1DFF040A1CFF050D20FF030C20FF040E23FF040F27FF061028FF071431FF08142FFF282A2CFF181919FF2C3032FF5E5F5EFF5A6061BFA2A4A4FF111314FF111722FF102E64FF12284FFF29323EFF162745FF123367FF142B4AFF141D2CFF171820FF15161AFF141315FF13110FFF151312FF161717FF171614FF171718FF151718FF16191BFF14181DFF0C111AFF0A172DFF121E2FFF1F2832FF0C2042FF0E244AFF292D36FF181919FF2D3132FF606160FF565E60BFA5A4A5FF111416FF0F131FFF0F2F6AFF1A335BFF3C444CFF1E3048FF142D4FFF353A39FF383834FF31332DFF282925FF262521FF24221EFF211F1DFF272622FF272622FF282724FF292724FF2C2A28FF3E3E37FF41413FFF1A212CFF1D262FFF2F383EFF102545FF0F284BFF2B3036FF1B1A1AFF2F3334FF636465FF5C6266BFADAEADFF131717FF0F1420FF103068FF10326CFF123063FF113672FF1F3A67FF4D504CFF4A4943FF35332FFF2E2C28FF302F29FF31302AFF2F2E2AFF302F2AFF30302BFF383733FF3D3A37FF343230FF3A3834FF464540FF1F2A3DFF0A1E44FF0E2650FF0C2651FF0D2449FF2C2F36FF1C1B1CFF2F3234FF626363FF5D6265BFB0B3B3FF151619FF0D121BFF0C224DFF0C2350FF0C2251FF0B2456FF1A2E53FF434544FF545551FF383634FF363430FF322F2BFF2E2B28FF302E2BFF32312BFF32322DFF373632FF3C3936FF403F3AFF45423FFF393733FF1D2435FF061635FF091C43FF091A3DFF0A1B38FF2C2F36FF1B1B1DFF2D3131FF5F6161FF60686CBFB6B7B8FF161619FF0B0F15FF0C274AFF0D2654FF0B2651FF0A2756FF304260FF5E605DFF575A57FF4C4D4BFF4B4B47FF494A46FF40413DFF3C3D38FF3D3D35FF3B3B36FF383935FF3C3B37FF444542FF4D4D49FF50514FFF1F293CFF061838FF081D3DFF091E3EFF091D34FF2A2D33FF1B1B1CFF2E3232FF606262FF5E6669BFACAAABFF101314FF0D1724FF1A4A8AFF194E8EFF1F395AFF163563FF4E74A4FFC2C8CFFFC7CAC6FFBFC2BFFFAFB0ACFF969794FF838481FF828280FF63635DFF67655FFF6E6D66FF787770FF8A8783FF969590FF8F99A2FF2C4C7DFF142E4DFF132A45FF133B6AFF113155FF2D3239FF1D1C1BFF2F3434FF626465FF585E61BFA2A3A4FF0E1312FF0D1A28FF1F5BA0FF225A9EFF485262FF38475FFF2260A7FF4079BEFF5C8CC3FF749DC8FF84A7C8FF91A9BFFF9EACB6FFC5CBCFFFACB3B6FF94A0A9FF7E94A7FF6A839FFF5A7A9FFF446C9DFF31629DFF1B4A85FF303745FF303B49FF184070FF14345EFF2E3138FF1C1A1CFF2F3433FF626365FF596162BFAAA8A9FF0F1313FF0E1B2EFF2264AEFF226AB7FF2B609CFF275D9CFF2C71C1FF296EC0FF2B71C2FF2D72C4FF2B6FC2FF2E71C2FF3577C3FF4381C6FF3F7DC1FF306FB7FF2866B0FF2562ACFF2662AAFF255EA4FF22599DFF225698FF1B4272FF1F4673FF154274FF15385DFF2E313BFF1B191AFF2F3434FF626464FF5C6565BFB0B0B0FF111416FF0A1322FF164184FF1B4B8AFF1B4B8BFF1C4E92FF1E4D91FF1D5293FF1F5195FF1E4F94FF1A5093FF1A498BFF1C4A8CFF1B4C8FFF1B498BFF1A4684FF194380FF1A4582FF194481FF19447BFF184174FF183E71FF173D6CFF12325FFF0F2B51FF112741FF292B31FF171717FF2E3132FF606062FF5E6469BFAFB1B4FF161B1AFF060503FF060A0BFF0C0F12FF0F121CFF14181BFF171A21FF1B1F24FF1E2328FF22272BFF262A2FFF262930FF292C33FF2C2F34FF2E3035FF2F3236FF303237FF31343AFF33363BFF323538FF323439FF33353AFF34363CFF2E3135FF2E3033FF2E2F32FF2E2E2FFF131112FF2E2F30FF605F5FFF646D69BFB4B4B5FF171918FF040305FF040506FF080808FF0B0909FF0F0E0DFF131312FF171617FF1B1A1BFF1E1E1EFF202121FF242525FF272727FF282828FF292929FF2B2B2CFF2D2D2EFF2E2D2FFF2F2E2FFF30302FFF2F2E2EFF2F2E2FFF2D2E2DFF2F2D2DFF2A292AFF262524FF20201FFF0C0D0CFF2F3435FF626263FF606866BFB2B2B4FF27282AFF151515FF141617FF121516FF141618FF131516FF141718FF151819FF16191AFF1A1E1EFF191D1DFF1A1D1DFF1B1D1EFF1C1F20FF1C1E1FFF1B1F1FFF1C1F20FF191D1EFF1C1E1FFF1A1B1EFF1B1B1CFF191A1CFF151819FF16181AFF151718FF131415FF121113FF0A0D0EFF343738FF646365FF5C626CBFDDDCD9FFB9B9BCFFBBBBB9FFB9B9B8FFB5B6B6FFB9BCBBFFB1B5B4FFB5B6B6FFB9BBB9FFB4B5B4FFBABABAFFB5B6B6FFB3B4B4FFB9BABAFFB3B4B5FFABABABFFA9A9A9FFA9AAAAFFA5A5A5FFA7A8A7FFA1A2A1FFA1A2A1FF9D9D9DFF969798FF989998FF9F9F9DFF969797FF898889FF969596FF979897FF737374FF2832387F697170BF606A6EBF616968BF5D6465BF5D6568BF5E6869BF5D6568BF656A6EBF60686ABF5C6466BF61686CBF5C6268BF5E6669BF646A6DBF5D6466BF596061BF596162BF5D6465BF5C6264BF5C6466BF596161BF586061BF565E60BF555D60BF565E61BF596164BF545C5EBF4D5256BF566062BF555E61BF40484CBF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000
)
WriteFile(A_workingdir "\logo.ico",picture)
}
return

WriteFile(file,data)
{
   Handle :=  DllCall("CreateFile","str",file,"Uint",0x40000000
                  ,"Uint",0,"UInt",0,"UInt",4,"Uint",0,"UInt",0)
   Loop
   { 
     if strlen(data) = 0
        break
     StringLeft, Hex, data, 2         
     StringTrimLeft, data, data, 2  
     Hex = 0x%Hex%
     DllCall("WriteFile","UInt", Handle,"UChar *", Hex
     ,"UInt",1,"UInt *",UnusedVariable,"UInt",0) 
    } 
  
   DllCall("CloseHandle", "Uint", Handle)
   return
}

icons:
{
picture =
loadHex()

picture := Ltrim picture

	VarSetCapacity( IconData,( nSize:=StrLen(picture)//2) )
	Loop %nSize%
		NumPut( "0x" . SubStr(picture,2*A_Index-1,2), IconData, A_Index-1, "Char" )
	picture := ""       
	hICon := DllCall( "CreateIconFromResourceEx", UInt,&IconData+22
					, UInt,0, Int,1, UInt,196608, Int,32, Int,32, UInt,0 )

	WinGet, PID, PID, A
		ID := WinExist("ahk_pid" PID)
			SendMessage, 0x80, 0, hIcon ,, ahk_id %ID%  ; Small Icon
			SendMessage, 0x80, 1, hIcon ,, ahk_id %ID%  ; Big Icon
}
return